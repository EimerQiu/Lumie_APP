# AutoMom 任务管理模块 PRD
## Product Requirements Document

**文档版本**: v1.0
**创建日期**: 2026-01-28
**文档类型**: 功能需求文档
**适用范围**: 作为独立模块集成到宿主应用

---

## 1. 产品概述

### 1.1 产品定位
AutoMom 是一个智能化的家庭任务管理系统，专为多成员家庭提供任务协调、进度跟踪和智能提醒服务。该模块可独立集成到其他应用中，为用户提供完整的任务管理能力。

### 1.2 核心价值
- **家庭协作**: 支持多成员家庭组织，实现任务分配和协作管理
- **智能模板**: 通过可复用的任务模板，快速创建重复性任务
- **AI 赋能**: 基于用户行为数据，提供个性化的任务完成建议
- **灵活管理**: 支持管理员和普通成员的权限分级管理

### 1.3 模块说明
本文档描述 AutoMom 的产品功能需求，供其他团队参考和融合。不包含技术实现细节和代码迁移方案。

---

## 2. 目标用户

### 2.1 用户画像

#### 主要用户群体
1. **家庭管理者** (Admin)
   - 年龄: 25-50 岁
   - 角色: 家长、家庭事务主要协调者
   - 需求: 规划和监督家庭成员的日常任务

2. **家庭成员** (Member)
   - 年龄: 10-60 岁
   - 角色: 子女、配偶、其他家庭成员
   - 需求: 接收任务、完成任务、查看进度

3. **个人用户** (Individual)
   - 年龄: 18-45 岁
   - 角色: 独立生活的个体
   - 需求: 管理个人日常任务和习惯养成

### 2.2 使用场景
- 家庭日常任务分配（家务、学习、运动等）
- 儿童教育和习惯培养
- 健康管理（用药提醒、锻炼计划）
- 工作和生活平衡
- 长期目标追踪

---

## 3. 核心功能需求

### 3.1 功能架构图

```
AutoMom 模块
├── 用户认证模块
│   ├── 邮箱登录
│   ├── 会话管理
│   └── 权限验证
├── 任务管理模块
│   ├── 任务创建
│   ├── 任务查看
│   ├── 任务完成
│   ├── 任务删除
│   └── 进度可视化
├── 模板管理模块
│   ├── 模板创建/编辑
│   ├── 时间窗口配置
│   ├── 批量任务生成
│   └── 模板分类
├── 家庭管理模块
│   ├── 家庭创建
│   ├── 成员邀请
│   ├── 权限管理
│   └── 成员状态
├── AI 智能助手
│   ├── 完成率分析
│   ├── 个性化建议
│   └── 数据可视化
└── 管理员仪表板
    ├── 全局任务视图
    ├── 成员管理
    ├── 奖励计算
    └── 数据搜索
```

---

## 4. 详细功能需求

### 4.1 用户认证模块

#### 4.1.1 登录功能
**优先级**: P0 (必须)

**功能描述**:
- 用户通过邮箱和密码登录系统
- 支持中英文双语界面切换
- 登录状态持久化保存

**输入**:
- 邮箱地址 (email)
- 密码 (password)
- 语言选择 (CN/EN)

**输出**:
- 用户 ID (userId)
- 用户邮箱 (email)
- 管理员标识 (isAdmin)
- 登录令牌 (可选)

**交互流程**:
1. 用户打开登录界面
2. 输入邮箱和密码
3. 点击登录按钮
4. 系统验证凭据
5. 成功后跳转到主界面
6. 失败则显示错误提示

**UI 要求**:
- 品牌展示: "Auto Mom" / "叨叨妈妈"
- 渐变背景 (蓝色到紫色)
- 错误消息以红色文本显示
- 语言切换按钮位于右上角

**验证规则**:
- 邮箱格式验证
- 密码长度 ≥ 6 位
- 网络错误处理
- 登录失败重试提示

---

#### 4.1.2 登出功能
**优先级**: P0 (必须)

**功能描述**:
- 用户可随时退出登录
- 清除本地缓存的会话信息
- 返回登录界面

**触发条件**:
- 用户在个人资料页点击 "Logout" 按钮

**系统行为**:
- 清除本地存储的 userId 和 email
- 重置应用状态
- 导航回登录界面

---

### 4.2 任务管理模块

#### 4.2.1 任务列表展示
**优先级**: P0 (必须)

**功能描述**:
- 展示当前用户所有待完成任务
- 按时间区间显示开始和结束时间
- 可视化进度条显示任务时间进度
- 支持下拉刷新

**数据模型**:
```
Task 任务对象
├── task_id: 唯一标识
├── task_name: 任务名称
├── task_type: 任务类型 (Medicine/Life/Study/Exercise/Work/Meditation/Love)
├── open_datetime: 开始时间 "yyyy-MM-dd HH:mm"
├── close_datetime: 结束时间 "yyyy-MM-dd HH:mm"
├── rpttask_id: 关联的重复任务模板 ID (可选)
├── small_task_id: 子任务序号 (可选)
└── task_info: 附加信息 (可选)
```

**UI 设计要求**:
- 黑色深色主题
- 每个任务卡片显示:
  - 任务名称 (大字体，白色)
  - 时间区间 (小字体，灰色)
  - 进度条 (渐变色，基于任务 ID 随机)
  - 进度百分比文本
- 任务按开始时间排序
- 支持滑动操作（完成/删除）

**交互行为**:
- 点击任务卡片 → 弹出确认完成对话框
- 下拉列表 → 刷新任务数据
- 向左滑动 → 显示完成和删除按钮

**数据刷新**:
- 进入界面时自动加载
- 后台每 180 秒自动轮询一次
- 用户手动下拉刷新

---

#### 4.2.2 任务创建
**优先级**: P0 (必须)

**功能描述**:
- 创建单个任务
- 支持选择目标成员（个人或家庭）
- 支持从模板快速创建

**输入字段**:
- 任务名称 (必填，最多 100 字符)
- 任务类型 (选填，7 种预定义类型)
- 开始时间 (必填，DatePicker)
- 结束时间 (必填，DatePicker，需晚于开始时间)
- 目标成员 (必填，单选)
- 附加信息 (选填，多行文本)

**创建方式**:
1. **手动创建**: 用户填写所有字段
2. **模板创建**: 选择已有模板，填充时间和成员

**验证规则**:
- 任务名称不能为空
- 结束时间必须晚于开始时间
- 必须选择目标成员
- 创建成功后跳转回任务列表

**API 端点**:
```
POST /add-task
Request Body:
{
    "task_name": string,
    "task_type": string (可选),
    "open_datetime": string,
    "close_datetime": string,
    "user_id": string (个人任务),
    "family_id": string (家庭任务，与 user_id 互斥),
    "task_info": string (可选),
    "rpttask_id": string (从模板创建时提供)
}
```

---

#### 4.2.3 任务完成
**优先级**: P0 (必须)

**功能描述**:
- 用户标记任务为已完成
- 完成后任务从列表移除
- 服务器端记录完成时间

**触发方式**:
1. 点击任务卡片 → 弹出确认对话框
2. 对话框显示任务名称和确认按钮
3. 点击 "Confirm" 提交完成请求
4. 成功后从本地列表移除

**确认对话框**:
- 标题: "Complete Task"
- 内容: "Are you sure you want to mark '{任务名称}' as completed?"
- 按钮: "Cancel" / "Confirm"

**API 端点**:
```
POST /task_complete
Request Body:
{
    "task_id": string,
    "time_zone": string (用户当前时区)
}
```

**错误处理**:
- 网络失败：显示错误提示，任务保留在列表
- 服务器错误：显示错误消息
- 成功：立即从 UI 移除任务

---

#### 4.2.4 任务删除（管理员功能）
**优先级**: P1 (重要)

**功能描述**:
- 管理员可删除任何用户的任务
- 普通用户可删除自己的任务
- 删除后无法恢复（需确认）

**触发方式**:
- 在任务列表向左滑动
- 点击红色 "Delete" 按钮
- 弹出二次确认对话框

**API 端点**:
```
DELETE /admin/delete_task/{taskId}
Query Params:
    time_zone: string
```

---

#### 4.2.5 进度可视化
**优先级**: P1 (重要)

**功能描述**:
- 实时显示任务在时间段内的完成进度
- 进度条颜色基于任务 ID 生成渐变色
- 显示百分比数值

**计算逻辑**:
```
进度百分比计算规则：
- 如果当前时间 < 开始时间：进度 = 0%
- 如果当前时间 > 结束时间：进度 = 100%
- 否则：进度 = (当前时间 - 开始时间) / (结束时间 - 开始时间) × 100%
```

**渐变色池**:
```
颜色方案（6 种渐变组合）：
1. Orange → Red (#FF9500 → #FF3B30)
2. Blue → Purple (#007AFF → #5856D6)
3. Green → Yellow (#34C759 → #FFCC00)
4. Pink → Purple (#FF2D55 → #5856D6)
5. Teal → Blue (#5AC8FA → #007AFF)
6. Indigo → Pink (#5856D6 → #FF2D55)

颜色选择：基于任务 ID 哈希值取模选择对应颜色
```

---

### 4.3 模板管理模块

#### 4.3.1 模板数据模型
**优先级**: P0 (必须)

**核心实体**:
```
RepeatTaskTemplate 重复任务模板
├── id: 模板唯一 ID
├── templateName: 模板名称
├── templateType: 类型 (7 种预定义类型)
├── description: 描述信息 (可选)
├── timeWindows: 时间窗口数量
├── minInterval: 最小间隔（分钟）
└── timeWindowList: 时间窗口列表
    └── TimeWindow 时间窗口
        ├── id: 窗口序号
        ├── name: 窗口名称 (如 "早晨", "下午")
        ├── openTime: 开始时间 "HH:mm"
        ├── closeTime: 结束时间 "HH:mm"
        └── isNextDay: 是否跨日期 (例如 23:00-01:00)
```

**任务类型枚举**:
- `Medicine` (用药提醒)
- `Life` (生活习惯)
- `Study` (学习计划)
- `Exercise` (运动健身)
- `Work` (工作任务)
- `Meditation` (冥想放松)
- `Love` (情感关怀)

---

#### 4.3.2 模板列表展示
**优先级**: P0 (必须)

**功能描述**:
- 展示用户创建的所有模板
- 按创建时间倒序排列
- 支持模板搜索和筛选

**UI 设计**:
- 卡片式布局
- 每个卡片显示:
  - 模板名称
  - 任务类型标签（带颜色编码）
  - 时间窗口数量
  - 最小间隔时间
  - 描述信息（可折叠）
- 操作按钮:
  - "Edit" (编辑)
  - "Delete" (删除)
  - "Create Tasks" (批量创建任务)

**API 端点**:
```
GET /repeat_task/list
Query Params:
    user_id: string
Response:
[
    {
        "rpttask_id": string,
        "template_name": string,
        "template_type": string,
        "description": string (可选),
        "time_windows": int,
        "min_interval": int
    },
    ...
]
```

---

#### 4.3.3 创建/编辑模板
**优先级**: P0 (必须)

**功能描述**:
- 创建新的任务模板
- 编辑已有模板
- 配置时间窗口和间隔

**输入字段**:
1. **基础信息**:
   - 模板名称 (必填，最多 50 字符)
   - 任务类型 (必填，Picker 选择)
   - 描述信息 (选填，多行文本)
   - 最小间隔 (必填，数字输入，单位：分钟)

2. **时间窗口配置**:
   - 窗口名称 (如 "早晨", "中午", "晚上")
   - 开始时间 (时间选择器)
   - 结束时间 (时间选择器)
   - 跨日期标记 (Toggle)
   - 支持添加多个时间窗口

**UI 交互**:
- 时间窗口采用列表形式展示
- 点击 "+" 按钮添加新窗口
- 向左滑动删除窗口
- 实时预览生成的任务数量

**验证规则**:
- 模板名称不能为空
- 至少配置 1 个时间窗口
- 最小间隔 > 0
- 时间窗口的结束时间需晚于开始时间（除非跨日期）

**API 端点**:
```
POST /repeat_task/create
Request Body:
{
    "template_name": string,
    "template_type": string,
    "description": string (可选),
    "min_interval": int,
    "time_windows": [
        {
            "windowName": string,
            "name": string,
            "openTime": string,  // "HH:mm" 格式
            "closeTime": string,
            "isNextDay": bool
        },
        ...
    ]
}

GET /repeat_task/detail/{templateId}
Response: 完整模板数据（用于编辑）
```

---

#### 4.3.4 批量创建任务（从模板）
**优先级**: P0 (必须)

**功能描述**:
- 从已有模板批量生成多天的任务
- 支持选择开始日期和持续天数
- 支持选择目标成员或家庭

**输入参数**:
- 开始日期 (DatePicker，默认今天)
- 持续天数 (Stepper，范围 1-30)
- 目标成员 (FamilyMemberSelector)

**生成逻辑**:
```
总任务数 = 持续天数 × 时间窗口数量

例如：
- 模板有 3 个时间窗口（早/中/晚）
- 选择 7 天
- 生成 21 个任务

每个任务：
- 开始时间 = 日期 + 窗口开始时间
- 结束时间 = 日期 + 窗口结束时间（考虑跨日期）
- 任务名称 = 模板名称 + 窗口名称
- 关联 rpttask_id = 模板 ID
```

**UI 显示**:
- 实时计算并显示: "This will create {X} tasks"
- 显示日期范围
- 显示目标成员名称
- 进度指示器（创建过程中）

**API 调用**:
```
对每个生成的任务调用：POST /add-task
```

**创建流程**:
1. 用户选择参数
2. 点击 "Create" 按钮
3. 系统计算任务列表
4. 逐个发送创建请求
5. 显示进度 "Creating X of Y tasks..."
6. 完成后显示成功消息
7. 返回模板列表

---

#### 4.3.5 删除模板
**优先级**: P1 (重要)

**功能描述**:
- 删除不再需要的模板
- 不影响已创建的任务
- 需要二次确认

**触发方式**:
- 在模板卡片上点击 "Delete" 按钮
- 弹出确认对话框: "Are you sure you want to delete this template?"

**API 端点**:
```
DELETE /repeat-task-template/{templateId}
```

---

### 4.4 家庭管理模块

#### 4.4.1 家庭数据模型
**优先级**: P0 (必须)

**核心实体**:
```
Family 家庭
├── family_id: 家庭唯一 ID
├── family_name: 家庭名称
├── family_admin: 管理员用户 ID
└── members: 成员列表
    └── FamilyMember 家庭成员
        ├── user_id: 成员用户 ID
        ├── name: 成员姓名
        ├── email: 成员邮箱
        └── status: 状态 ("active" / "adding" / "invited")
```

---

#### 4.4.2 创建家庭
**优先级**: P0 (必须)

**功能描述**:
- 用户可创建多个家庭组织
- 创建者自动成为管理员
- 家庭名称唯一性验证

**输入字段**:
- 家庭名称 (必填，最多 30 字符)

**API 端点**:
```
POST /family/create
Request Body:
{
    "family_name": string,
    "admin_user_id": string
}
Response:
{
    "family_id": string,
    "family_name": string,
    "message": string
}
```

**验证规则**:
- 家庭名称不能为空
- 家庭名称不能与已有家庭重复（同一用户）

---

#### 4.4.3 邀请家庭成员
**优先级**: P0 (必须)

**功能描述**:
- 管理员通过邮箱邀请成员加入家庭
- 被邀请者收到邀请通知
- 支持批量邀请

**输入字段**:
- 成员邮箱 (必填，支持多个)
- 家庭选择 (Picker)

**邀请流程**:
1. 管理员输入成员邮箱
2. 系统发送邀请请求
3. 成员状态标记为 "adding"
4. 被邀请者在个人资料页看到待处理邀请
5. 被邀请者选择 "Agree" 或 "Reject"
6. 状态更新为 "active" 或移除

**API 端点**:
```
POST /family/invite
Request Body:
{
    "family_id": string,
    "emails": [string],
    "inviter_user_id": string
}

POST /family/respond
Request Body:
{
    "family_id": string,
    "user_id": string,
    "response": "Agree" | "Reject"
}
```

**UI 显示**:
- 邀请列表显示在个人资料页顶部
- 每个邀请卡片显示:
  - 家庭名称
  - 邀请者邮箱
  - "Agree" 和 "Reject" 按钮

---

#### 4.4.4 家庭成员列表
**优先级**: P1 (重要)

**功能描述**:
- 展示家庭所有成员
- 显示成员状态
- 管理员可移除成员

**API 端点**:
```
GET /family/my-families
Query Params:
    user_id: string
Response:
[
    {
        "family_id": string,
        "family_name": string,
        "family_admin": string,
        "members": [
            {
                "user_id": string,
                "name": string,
                "email": string,
                "status": string
            },
            ...
        ]
    },
    ...
]
```

**UI 设计**:
- 家庭卡片展示（可折叠）
- 成员列表展示姓名和邮箱
- 管理员标记（特殊图标）
- 状态徽章:
  - "active": 绿色
  - "adding": 黄色
  - "invited": 灰色

---

#### 4.4.5 家庭成员选择器
**优先级**: P0 (必须)

**功能描述**:
- 在创建任务时选择目标成员
- 支持个人任务和家庭任务
- 可视化成员卡片

**选择模式**:
1. **个人任务**: 选择 "Personal Task" 卡片
2. **家庭任务**: 选择某个家庭，再选择具体成员

**UI 设计**:
- 顶部显示 "Personal Task" 卡片
  - 图标: 人物轮廓
  - 颜色: 蓝色渐变
  - 点击选中后高亮

- 下方显示家庭列表
  - 家庭卡片展示家庭名称
  - 点击展开成员列表
  - 成员卡片显示:
    - 姓名
    - 邮箱
    - 渐变色背景（基于 user_id 哈希）
    - 选中状态（边框高亮）

**交互行为**:
- 单选模式（一次只能选择一个目标）
- 选择后返回 user_id 或 family_id

---

### 4.5 AI 智能助手

#### 4.5.1 个性化任务建议
**优先级**: P1 (重要)

**功能描述**:
- 基于用户近期任务完成情况生成智能建议
- 分析完成率、过期率等指标
- 提供可操作的改进建议

**数据模型**:
```
AiTipsRequest 请求
├── timezone: 时区
└── days_back: 分析过去 N 天，默认 7

AiTipsResponse 响应
├── status: 状态 ("success" / "error")
├── tip: AI 生成的建议文本
├── stats: 统计数据 (可选)
│   ├── total_tasks: 总任务数
│   ├── completed_tasks: 已完成任务数
│   ├── completion_rate: 完成率 (0.0-1.0)
│   ├── expired_tasks: 过期任务数
│   └── analysis_period_days: 分析周期
└── message: 错误消息 (可选)
```

**API 端点**:
```
POST /ai-tips?user_id={userId}
Request Body:
{
    "timezone": "America/Los_Angeles",
    "days_back": 7
}
```

**UI 设计**:
- 卡片式展示，位于任务列表顶部
- 灯泡图标 + 脉冲动画效果
- 白色背景，圆角阴影
- 建议文本可滚动查看
- 底部显示统计数据:
  - "Total: X tasks"
  - "Completed: Y tasks (Z%)"
  - "Expired: W tasks"
- 刷新按钮（手动触发）

**触发时机**:
- 进入任务列表时自动加载
- 用户点击刷新按钮
- 完成任务后自动刷新（可选）

**加载状态**:
- 显示加载动画
- 文本: "Generating tips..."
- 失败后显示: "Unable to fetch tips. Try again."

---

#### 4.5.2 数据统计可视化
**优先级**: P2 (次要)

**功能描述**:
- 在 AI 提示卡片下方展示关键指标
- 简洁的文本展示，无复杂图表

**展示内容**:
- 分析周期: "Based on last {N} days"
- 总任务数
- 完成任务数和百分比
- 过期任务数

**设计风格**:
- 小字体灰色文本
- 图标 + 数字形式
- 横向排列

---

### 4.6 管理员仪表板

#### 4.6.1 全局任务视图
**优先级**: P0 (必须，仅管理员可见)

**功能描述**:
- 管理员查看所有家庭成员的任务
- 按时间分类：过去任务 / 即将进行的任务
- 支持任务搜索和筛选

**数据模型**:
```
AdminTaskData 管理员任务数据
├── task_id: 任务 ID
├── task_name: 任务名称
├── task_type: 任务类型 (可选)
├── open_datetime: 开始时间 (ISO8601 格式)
├── close_datetime: 结束时间
├── user_id: 成员用户 ID
├── userName: 成员姓名
├── userEmail: 成员邮箱
├── status: 任务状态 ("Completed" / "Ongoing" / "Pending")
├── family_id: 家庭 ID (可选)
├── family_name: 家庭名称 (可选)
├── rpttask_id: 模板 ID (可选)
└── small_task_id: 子任务序号 (可选)
```

**API 端点**:
```
GET /admin/task-list-ios
Query Params:
    user_id: string (管理员 ID)
    time_zone: string
    limit: int (默认 10)
    offset: int (默认 0)
    time_filter: "previous" | "upcoming"
Response:
{
    "tasks": [AdminTaskData],
    "has_more": bool
}
```

**UI 设计**:
- Tab 切换: "Previous Tasks" / "Upcoming Tasks"
- 任务列表展示:
  - 任务名称
  - 成员姓名和邮箱
  - 家庭名称（如果是家庭任务）
  - 状态徽章（颜色编码）
  - 时间信息
- 分页加载（每次 10 条）
- 滚动到底部自动加载更多

**任务操作**:
- 向左滑动显示操作按钮
- "Complete" (绿色) - 标记完成
- "Delete" (红色) - 删除任务

**状态徽章颜色**:
- `Completed`: 绿色
- `Ongoing`: 蓝色
- `Pending`: 黄色
- 其他: 灰色

---

#### 4.6.2 搜索和过滤
**优先级**: P1 (重要)

**功能描述**:
- 按成员邮箱搜索任务
- 快速访问特定家庭成员
- 过滤特定任务类型

**UI 组件**:
- 搜索框: "Search by email..."
- 快速访问按钮列表（家庭成员）
- 任务类型筛选 Picker

**搜索逻辑**:
- 实时搜索（输入时触发）
- 匹配成员邮箱
- 重新加载任务列表

---

#### 4.6.3 奖励计算
**优先级**: P2 (次要)

**功能描述**:
- 查询成员的任务完成情况
- 计算奖励积分（基于完成率）
- 展示奖励任务列表

**API 端点**:
```
GET /admin/reward-calc
Query Params:
    email: string (成员邮箱)
    time_zone: string
Response:
{
    "total_tasks": int,
    "completed_tasks": int,
    "completion_rate": double,
    "reward_points": int,
    "tasks": [AdminTaskData]
}
```

**UI 设计**:
- 输入成员邮箱
- 显示计算结果卡片
- 任务列表展示（可选中）

---

### 4.7 通知系统

#### 4.7.1 推送通知
**优先级**: P1 (重要)

**功能描述**:
- 任务开始提醒
- 任务即将结束提醒
- 任务分配通知
- 家庭邀请通知

**权限请求**:
- 应用启动时请求通知权限
- 用户可在系统设置中管理

**触发时机**:
- 任务开始时间前 15 分钟
- 任务结束前 30 分钟
- 新任务分配立即通知
- 家庭邀请立即通知

---

#### 4.7.2 后台刷新
**优先级**: P1 (重要)

**功能描述**:
- 应用在后台定期刷新任务数据
- 确保通知及时触发
- 优化电池使用

**刷新策略**:
- 前台: 每 180 秒轮询
- 后台: 每 1 小时刷新
- 远程推送触发: 立即刷新

---

## 5. 用户故事与使用场景

### 5.1 场景一：家长管理孩子学习计划

**角色**: 李女士（管理员）、小明（孩子，家庭成员）

**故事**:
李女士希望帮助 10 岁的儿子小明养成良好的学习习惯。她使用 AutoMom 模块创建了一个 "每日学习计划" 模板，包含三个时间窗口：
- 早晨 (07:00-08:00): 背诵英语单词
- 下午 (16:00-17:00): 完成作业
- 晚上 (19:00-20:00): 阅读课外书

她为小明批量生成了一周的学习任务。小明在 iOS 应用上看到每天的任务，完成后点击确认。李女士在管理员仪表板上监控小明的完成情况，系统根据完成率生成鼓励建议。

**使用步骤**:
1. 李女士登录应用，创建 "学习计划" 家庭
2. 邀请小明加入家庭（通过邮箱）
3. 创建 "每日学习计划" 模板，选择 Study 类型
4. 配置三个时间窗口
5. 批量创建 7 天任务，目标成员选择小明
6. 小明在任务列表查看今日任务
7. 完成后点击任务卡片，确认完成
8. 李女士在管理员仪表板查看完成情况

---

### 5.2 场景二：个人健康管理

**角色**: 张先生（个人用户）

**故事**:
张先生患有慢性疾病，需要每天定时服药和测量血压。他创建了 "用药提醒" 模板，设置了早中晚三次服药时间。同时创建了 "运动计划" 模板，每天晚上提醒散步 30 分钟。应用每天自动生成任务，张先生完成后标记，系统根据完成情况生成健康建议。

**使用步骤**:
1. 张先生登录应用
2. 创建 "用药提醒" 模板（Medicine 类型）
3. 创建 "运动计划" 模板（Exercise 类型）
4. 批量生成 30 天任务，目标选择 "Personal Task"
5. 每天接收任务提醒通知
6. 完成后点击确认
7. 查看 AI 智能助手的健康建议

---

### 5.3 场景三：家庭家务分工

**角色**: 王先生（管理员）、王女士（配偶）、小红（女儿）

**故事**:
王先生创建了 "温馨之家" 家庭，邀请妻子和女儿加入。他创建了多个家务模板：
- "厨房清洁"（每天早晚）
- "遛狗"（每天三次）
- "垃圾清理"（每周二、五）

他为不同成员分配任务，确保家务均衡分配。每周查看完成情况，对表现好的成员给予奖励。

**使用步骤**:
1. 王先生创建 "温馨之家" 家庭
2. 邀请妻子和女儿加入
3. 创建多个家务模板（Life 类型）
4. 为不同成员批量创建任务
5. 成员们在各自手机上查看任务
6. 王先生在管理员仪表板查看全家完成情况
7. 使用奖励计算功能统计每周积分

---

## 6. 数据流与系统交互

### 6.1 整体数据流图

```
┌─────────────┐
│   客户端    │
│  (UI Layer) │
└──────┬──────┘
       │
       │ 用户交互
       ▼
┌─────────────┐
│  数据管理层  │
│ (ViewModel) │
└──────┬──────┘
       │
       │ HTTP API
       ▼
┌─────────────┐
│   Backend   │
│  API Server │
└──────┬──────┘
       │
       │ 数据库操作
       ▼
┌─────────────┐
│  Database   │
│ (用户/任务) │
└─────────────┘
```

---

### 6.2 关键 API 端点汇总

| 功能模块 | HTTP 方法 | 端点 | 描述 |
|---------|----------|------|------|
| 认证 | POST | /checkemail | 用户登录 |
| 任务 | GET | /fetch-tasks | 获取任务列表 |
| 任务 | POST | /add-task | 创建单个任务 |
| 任务 | POST | /task_complete | 标记任务完成 |
| 任务 | DELETE | /admin/delete_task/{id} | 删除任务 |
| 模板 | GET | /repeat_task/list | 获取模板列表 |
| 模板 | POST | /repeat_task/create | 创建模板 |
| 模板 | GET | /repeat_task/detail/{id} | 获取模板详情 |
| 模板 | DELETE | /repeat-task-template/{id} | 删除模板 |
| 家庭 | GET | /family/my-families | 获取家庭列表 |
| 家庭 | POST | /family/create | 创建家庭 |
| 家庭 | POST | /family/invite | 邀请成员 |
| 家庭 | POST | /family/respond | 响应邀请 |
| AI | POST | /ai-tips | 获取智能建议 |
| 管理员 | GET | /admin/task-list-ios | 获取全局任务 |
| 管理员 | POST | /admin/task_complete | 管理员完成任务 |
| 管理员 | GET | /admin/reward-calc | 奖励计算 |

---

### 6.3 数据同步策略

**实时同步**:
- 用户操作后立即调用 API
- 操作包括：创建任务、完成任务、删除任务

**定期轮询**:
- 前台应用：每 180 秒获取一次任务列表
- 后台应用：每 1 小时刷新一次

**缓存策略**:
- 登录信息缓存到本地存储
- 任务列表缓存在内存
- 家庭数据按需获取，不持久化

**离线处理**:
- 网络错误时显示错误提示
- 任务数据保留在内存，不清空
- 用户可重试操作

---

## 7. 非功能性需求

### 7.1 性能要求

**响应时间**:
- API 请求响应时间 < 2 秒
- UI 操作响应时间 < 100ms
- 列表滚动流畅度 ≥ 60 FPS

**数据加载**:
- 任务列表加载时间 < 3 秒
- 模板列表加载时间 < 2 秒
- 批量创建任务每个请求 < 1 秒

**内存使用**:
- 应用内存占用 < 100 MB
- 后台内存占用 < 50 MB

---

### 7.2 安全要求

**认证安全**:
- 使用 HTTPS 加密传输
- 密码采用安全哈希算法（服务器端）
- 会话令牌定期刷新（如果实现）

**数据安全**:
- 敏感信息（密码）不在本地存储
- 本地数据可选择加密
- API 请求包含用户身份验证

**权限控制**:
- 管理员和成员权限分离
- 仅管理员可访问管理员仪表板
- 家庭成员只能查看/操作自己的任务

---

### 7.3 兼容性要求

**iOS 版本**:
- 最低支持版本: iOS 14.0+
- 推荐版本: iOS 15.0+
- 最新版本: iOS 17.0 (测试通过)

**设备支持**:
- iPhone: 全系列（SE, 13, 14, 15, 16）
- iPad: 支持（需适配大屏）
- iPad Pro: 支持

**网络要求**:
- 支持 Wi-Fi 和蜂窝网络
- 最低网速: 3G (1 Mbps)
- 推荐网速: 4G/5G (10 Mbps+)

---

### 7.4 可用性要求

**国际化**:
- 支持中文（简体）
- 支持英文
- 日期时间本地化
- 时区自动识别

**无障碍**:
- 支持 VoiceOver
- 支持动态字体大小
- 颜色对比度符合 WCAG AA 标准
- 按钮触控区域 ≥ 44x44 pt

**错误处理**:
- 网络错误友好提示
- 表单验证错误实时反馈
- 操作失败支持重试
- 关键操作二次确认

---

## 8. UI/UX 设计规范

### 8.1 视觉风格

**主题**:
- 深色主题为主（任务列表）
- 登录界面：蓝紫渐变背景
- 白色/浅灰色背景（管理页面）

**颜色规范**:
```
主色调:
- Primary Blue: #007AFF
- Primary Purple: #5856D6

任务渐变色池:
- Orange → Red: #FF9500 → #FF3B30
- Blue → Purple: #007AFF → #5856D6
- Green → Yellow: #34C759 → #FFCC00
- Pink → Purple: #FF2D55 → #5856D6
- Teal → Blue: #5AC8FA → #007AFF
- Indigo → Pink: #5856D6 → #FF2D55

状态颜色:
- Success Green: #34C759
- Warning Yellow: #FFCC00
- Error Red: #FF3B30
- Info Blue: #007AFF
- Gray: #8E8E93

文本颜色:
- Primary Text: #FFFFFF (深色主题)
- Primary Text: #000000 (浅色主题)
- Secondary Text: #8E8E93
- Placeholder Text: #C7C7CC
```

**字体规范**:
```
系统字体: SF Pro (iOS 系统默认)

字号:
- Large Title: 34 pt (粗体)
- Title 1: 28 pt (粗体)
- Title 2: 22 pt (粗体)
- Title 3: 20 pt (粗体)
- Headline: 17 pt (半粗体)
- Body: 17 pt (常规)
- Callout: 16 pt (常规)
- Subhead: 15 pt (常规)
- Footnote: 13 pt (常规)
- Caption 1: 12 pt (常规)
- Caption 2: 11 pt (常规)
```

**间距规范**:
```
边距 (Padding):
- Extra Small: 4 pt
- Small: 8 pt
- Medium: 16 pt
- Large: 24 pt
- Extra Large: 32 pt

圆角 (Corner Radius):
- Small: 8 pt
- Medium: 12 pt
- Large: 16 pt
- Extra Large: 20 pt

阴影 (Shadow):
- Elevation 1: radius=2, opacity=0.1, y=1
- Elevation 2: radius=4, opacity=0.15, y=2
- Elevation 3: radius=8, opacity=0.2, y=4
```

---

### 8.2 组件设计

**按钮规范**:
```
主要按钮 (Primary Button):
- 背景色: Primary Blue
- 文字色: White
- 圆角: 12 pt
- 高度: 50 pt
- 字体: Body (17 pt, 半粗体)

次要按钮 (Secondary Button):
- 背景色: Transparent
- 边框: 2 pt Primary Blue
- 文字色: Primary Blue
- 圆角: 12 pt
- 高度: 50 pt

危险按钮 (Destructive Button):
- 背景色: Error Red
- 文字色: White
- 其他同主要按钮
```

**卡片规范**:
```
任务卡片:
- 背景色: #1C1C1E (深色)
- 圆角: 16 pt
- 内边距: 16 pt
- 阴影: Elevation 2
- 渐变进度条高度: 6 pt

模板卡片:
- 背景色: White
- 圆角: 12 pt
- 内边距: 16 pt
- 阴影: Elevation 1
- 类型标签圆角: 8 pt

家庭/成员卡片:
- 渐变背景（基于 ID 哈希）
- 圆角: 16 pt
- 内边距: 20 pt
- 选中边框: 3 pt Primary Blue
```

**输入框规范**:
```
文本框:
- 背景色: #F2F2F7 (浅色主题) / #2C2C2E (深色主题)
- 圆角: 10 pt
- 内边距: 12 pt 16 pt
- 高度: 44 pt
- 字体: Body (17 pt)
- 占位符颜色: Placeholder Text

多行文本框:
- 同文本框
- 最小高度: 100 pt
- 最大高度: 200 pt (可滚动)
```

**列表规范**:
```
列表项:
- 高度: 最小 60 pt (自适应内容)
- 背景色: System Background
- 分割线: #C7C7CC, 高度 0.5 pt
- 左边距: 16 pt
- 右边距: 16 pt

滑动操作按钮:
- 宽度: 80 pt
- 图标大小: 24x24 pt
- 完成: Green
- 删除: Red
```

---

### 8.3 动画与交互

**页面转场**:
- 默认: Push/Pop 动画（0.3s）
- 模态: Sheet 弹出（0.35s，弹性效果）
- 全屏: Full Screen Cover（0.4s）

**加载状态**:
- 旋转加载动画
- 骨架屏（可选）
- 文字提示: "Loading..." / "加载中..."

**按钮反馈**:
- 点击: Scale 效果（0.95 倍缩放，0.1s）
- 长按: 震动反馈（haptic feedback）
- 滑动: 平滑跟随手指

**特殊动画**:
- AI 提示灯泡: 脉冲动画（循环，1.5s 周期）
- 进度条: 填充动画（0.5s，ease-in-out）
- 卡片选中: 边框高亮动画（0.2s）

---

### 8.4 导航结构

```
TabView (底部导航)
├── Tab 1: 任务列表 (icon: checklist)
│   ├── 任务列表视图
│   ├── AI 提示卡片
│   └── 添加任务按钮 (浮动)
├── Tab 2: 管理员仪表板 (icon: chart.bar, 仅管理员可见)
│   ├── Previous Tasks
│   ├── Upcoming Tasks
│   └── 搜索功能
└── Tab 3: 个人资料 (icon: person.circle)
    ├── 用户信息
    ├── 家庭管理
    ├── 邀请处理
    └── 登出按钮

导航栏 (顶部)
├── 标题: 当前页面名称
├── 返回按钮 (左侧，子页面)
└── 操作按钮 (右侧，如 "Save", "Edit")
```

---

## 9. 版本规划

### 9.1 版本路线图

**v1.0 (MVP - Minimum Viable Product)**:
- ✅ 用户登录/登出
- ✅ 任务列表展示
- ✅ 任务创建/完成
- ✅ 基础家庭管理
- ✅ 模板创建和使用

**v1.1 (增强功能)**:
- AI 智能提示
- 管理员仪表板
- 奖励计算
- 通知系统

**v1.2 (优化迭代)**:
- 离线模式支持
- 数据统计图表
- 任务标签和筛选
- 用户设置页面

**v2.0 (未来规划)**:
- 多语言支持（日语、韩语等）
- 语音输入任务
- 任务模板市场
- 社交分享功能

---

## 10. 风险与挑战

### 10.1 产品风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 用户学习成本高 | 高 | 中 | 新手引导、示例模板、帮助文档 |
| 功能复杂度过高 | 中 | 中 | 简化流程、隐藏高级功能、分阶段发布 |
| 用户留存率低 | 高 | 中 | 通知提醒、游戏化设计、奖励机制 |
| 竞品压力 | 中 | 高 | 差异化功能、AI 赋能、社区运营 |

---

### 10.2 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| API 不稳定 | 高 | 中 | 实现重试机制、本地缓存、降级方案 |
| 数据同步冲突 | 中 | 低 | 乐观锁、版本号控制 |
| 性能瓶颈 | 中 | 中 | 分页加载、异步处理、性能监控 |
| 网络依赖性强 | 高 | 中 | 离线缓存、优雅降级 |

---

### 10.3 安全风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|---------|
| 数据泄露 | 高 | 低 | HTTPS 加密、敏感数据加密存储 |
| 账户被盗 | 中 | 低 | 密码强度验证、双因素认证（可选） |
| API 滥用 | 中 | 中 | 速率限制、令牌验证 |
| 中间人攻击 | 高 | 极低 | SSL Pinning、证书验证 |

---

## 11. 成功指标 (KPI)

### 11.1 产品指标

**用户增长**:
- 月活跃用户 (MAU)
- 日活跃用户 (DAU)
- DAU/MAU 比率 > 30%
- 用户留存率:
  - 次日留存 > 40%
  - 7 日留存 > 25%
  - 30 日留存 > 15%

**用户参与度**:
- 日均使用时长 > 5 分钟
- 日均任务完成数 > 3
- 模板创建率 > 20%
- 家庭创建率 > 30%

**功能使用**:
- AI 提示查看率 > 60%
- 模板使用率 > 50%
- 家庭协作用户占比 > 40%
- 管理员活跃度 > 70%

---

### 11.2 质量指标

**性能**:
- API 响应时间 P95 < 2 秒
- 应用启动时间 < 2 秒
- 崩溃率 < 0.1%
- 应用无响应 (ANR) < 0.05%

**用户体验**:
- App Store 评分 > 4.5
- NPS (Net Promoter Score) > 50
- 客户支持满意度 > 90%
- Bug 修复周期 < 7 天

---

### 11.3 商业指标

**市场表现**:
- App Store 排名（生产力类）< 100
- 有机下载占比 > 60%
- 付费转化率（如有付费功能）> 5%

---

## 12. 附录

### 12.1 术语表

| 术语 | 英文 | 定义 |
|------|------|------|
| 任务 | Task | 用户需要在特定时间完成的单个活动 |
| 模板 | Template | 可复用的任务配置，用于批量生成任务 |
| 时间窗口 | Time Window | 模板中定义的任务可执行时间段 |
| 家庭 | Family | 多个用户组成的协作组织 |
| 管理员 | Admin | 拥有全局查看和管理权限的用户角色 |
| 成员 | Member | 家庭中的普通用户 |
| 进度 | Progress | 任务在其时间段内的完成百分比 |
| 完成率 | Completion Rate | 已完成任务数 / 总任务数 |
| 轮询 | Polling | 定期向服务器请求最新数据 |
| 跨日期 | Next Day | 时间窗口的结束时间在第二天 |

---

### 12.2 变更日志

**v1.0 (2026-01-28)**:
- 初始 PRD 文档创建
- 基于现有 AutoMom 应用反向工程
- 定义核心功能和产品需求
- 去除技术实现细节，专注产品规格

---

### 12.3 联系信息

**产品负责人**: [待定]
**设计负责人**: [待定]

**文档地址**: https://docs.automom.app
**支持邮箱**: support@automom.app

---

## 结语

本 PRD 文档基于对 AutoMom iOS 应用的全面分析，系统化地定义了该应用作为独立模块的产品功能需求。文档专注于产品规格说明，避免技术实现细节，便于其他团队参考并融合到各自的产品中。

**核心价值主张**:
AutoMom 不仅是一个任务管理工具，更是一个智能化的家庭协作平台。通过可复用的模板系统、灵活的家庭管理和 AI 赋能的个性化建议，帮助用户高效管理日常任务、培养良好习惯、促进家庭成员协作。

**适用场景**:
- 其他团队参考融合功能需求
- 产品经理制定集成方案
- 设计团队了解 UI/UX 规范
- 项目管理人员评估工作量

**下一步行动**:
1. 产品团队审核 PRD，确认需求优先级
2. 根据宿主应用特点，制定融合 PRD
3. 设计团队适配 UI/UX 到目标风格
4. 规划开发工作，按模块迭代实施
5. 持续收集用户反馈，优化产品体验

---

**文档版本**: v1.0
**最后更新**: 2026-01-28
**状态**: ✅ 已完成产品需求定义
